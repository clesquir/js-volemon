<template name="game">

	<div class="app-section app-section-center">

		<div class="app-section-inner">

			{{#if isGameOnGoing}}

				<div class="game-container">

					{{! Names and Points }}

					<div class="players-container">
						<p class="players-names"><div>{{hostName}}</div><div>{{clientName}}</div></p>
						<p class="players-points">{{hostPoints}} | {{clientPoints}}</p>
					</div>

					<div class="timers-container">
						<div class="match-timer">{{matchTimer}}</div>
						<div class="point-timer">{{pointTimer}}</div>
					</div>

					<div class="viewers-container">
						<span>
							{{#if hasViewer}}
								{{viewers}}<i class="fa fa-eye"></i>
							{{/if}}
						</span>
					</div>

					{{! Game container }}

					<div id="gameContainer" class="page game"></div>

					<div id="afterGameContainer" class="after-game-container {{getStatusDependentClass}}">
						<div>
							<div>
								<div class="after-game-item after-game-title">{{getAfterGameTitle}}</div>

								{{#if isGameStatusFinished}}
									<div class="after-game-item after-game-elo">
										{{#each players}}
											<div>
												<div class="player-name">{{name}}</div>
												<div>{{getPlayerEloRating this ../profiles}}</div>
												<div>{{> eloRatingChange getPlayerProfile this ../profiles}}</div>
											</div>
										{{/each}}
									</div>
								{{/if}}

								<div class="after-game-item after-game-actions">
									<strong>What do you want to do next?</strong>
									<div><a href="{{pathFor 'home'}}">Go to the homepage</a></div>
									<div><a href="{{pathFor 'rank'}}">View rank</a></div>
								</div>
							</div>
						</div>
					</div>

				</div>

			{{else}}

				{{! Share URL }}

				{{#if isHost}}
					<h1>Creating a game</h1>

					<p>Share this link with someone</p>
					<p>
						<div class="copyable-url-input">
							<input type="text" value="{{urlFor 'game' _id=game._id}}" readonly="readonly" name="url" />
							<i class="fa fa-clipboard" data-action="copy-url" data-tooltip="Copy to clipboard" data-tooltip-direction="s"></i>
						</div>
					</p>

					<p style="text-align: right;">
						{{> switchButton label="Private" dataAction="update-privacy" onOffMethod=isPrivateGame}}
					</p>

					<p style="text-align: right;">
						{{> switchButton label="Bonus" dataAction="update-has-bonuses" onOffMethod=hasBonusesGame}}
					</p>
				{{else}}
					<h1>Joining a game</h1>

					<p class="not-editable" style="text-align: right;">
						{{> switchButton label="Bonus" dataAction="update-has-bonuses" onOffMethod=hasBonusesGame}}
					</p>
				{{/if}}

				{{! Players list }}

				<div class="table-list">
					<div class="table-list-row table-list-header">
						<div class="table-list-cell">Players</div>
						<div class="table-list-cell" style="flex: 0 0 75px;">Shape</div>
					</div>

					{{#each players}}
					<div class="table-list-row">
						<div class="table-list-cell">{{name}}</div>
						<div class="table-list-cell" style="flex: 0 0 75px;">
							{{#if isCurentPlayer}}
								{{> shapeSelector player=this shape=shape}}
							{{else}}
								<img src="/assets/player-{{shape}}-small.png" />
							{{/if}}
						</div>
					</div>
					{{/each}}
				</div>

				<br />

				{{! Buttons }}

				{{#if isHost}}

					{{#if hasEnoughPlayers}}

						{{#if allPlayersAreReady}}
							<a href="#" data-action="start" class="button">Start game</a>
						{{else}}
							<p>Waiting for all players to be ready...</p>
						{{/if}}

					{{else}}
						<p>Waiting for a player to join the game...</p>
					{{/if}}

				{{else}}

					<div class="game-client-buttons">
						{{#if canSetReadyOrLeave}}
							<a href="#" data-action="set-player-is-ready" class="button ready-button">Ready!</a>
							<a href="#" data-action="leave" class="button">Leave</a>
						{{/if}}

						{{#if canJoin}}
							<a href="#" data-action="join" class="button">Join</a>
						{{/if}}

						{{#if waitingForGameToStart}}
							<p>Waiting for the host to start the game...</p>
						{{/if}}

					</div>

				{{/if}}

			{{/if}}

		</div>

	</div>

</template>
